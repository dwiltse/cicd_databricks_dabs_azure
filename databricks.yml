bundle:
  name: insurance-customer-pipeline-azure

include:
  - resources/*.yml

variables:
  databricks_host:
    description: "Azure Databricks workspace URL"
    default: "https://adb-3328355783918896.16.azuredatabricks.net"
  catalog:
    description: "Unity Catalog name"
    default: insurance_demo_dev
  schema:
    description: "Schema name within catalog"
    default: customers
  developer_schema:
    description: "Per-developer schema pattern (dev only)"
    default: "dev_${workspace.current_user.short_name}"
  external_location:
    description: "Unity Catalog external location name for Azure Blob Storage"
    default: "demodata"
  azure_connection_name:
    description: "External connection name for Azure Blob Storage"
    default: "demodata"
  azure_customer_path:
    description: "Unity Catalog external location path to customer data"
    default: "${var.external_location}/insurance/${bundle.target}/customers/"
  notification_email:
    description: "Email address for pipeline notifications"
    default: "your-email@company.com"
  allow_full_refresh:
    description: "Guard against accidental full refresh in production"
    default: false

targets:
  dev:
    mode: development
    default: true
    workspace:
      host: ${var.databricks_host}
      root_path: /Workspace/Users/${workspace.current_user.userName}/.bundle/${bundle.name}/${bundle.target}
    variables:
      catalog: insurance_demo_dev
      schema: ${var.developer_schema}
      notification_email: "dev-team@company.com"
      allow_full_refresh: true
      
  staging:
    mode: development
    workspace:
      host: ${var.databricks_host}
      root_path: /Workspace/Shared/.bundle/${bundle.name}/${bundle.target}
    variables:
      catalog: insurance_demo_staging
      schema: customers
      external_location: "azure_blob_customer_data_staging"
      azure_connection_name: "azure_blob_customer_data_staging"
      notification_email: "staging-team@company.com"
      allow_full_refresh: false
    permissions:
      - level: CAN_MANAGE
        group_name: "data-engineers"
      - level: CAN_VIEW
        group_name: "data-analysts"
      
  prod:
    mode: production
    workspace:
      host: ${var.databricks_host}
      root_path: /Workspace/Shared/.bundle/${bundle.name}/${bundle.target}
    variables:
      catalog: insurance_demo_prod
      schema: customers
      external_location: "azure_blob_customer_data_prod"
      azure_connection_name: "azure_blob_customer_data_prod"
      notification_email: "prod-alerts@company.com"
      allow_full_refresh: false
    permissions:
      - level: CAN_MANAGE
        group_name: "data-platform-admins"
      - level: CAN_VIEW
        group_name: "data-engineers"
      - level: CAN_VIEW
        group_name: "data-analysts"